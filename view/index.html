<!DOCTYPE html>

<head>
    <title>Epoch Link Shortener</title>
    <meta property="og:title" content="Epoch Link Shortener" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
</head>
<script>
    function isURL(str) {
        const pattern = new RegExp('^(https?:\\/\\/)?' + // protocol
            '((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|' + // domain name
            '((\\d{1,3}\\.){3}\\d{1,3}))' + // OR ip (v4) address
            '(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*' + // port and path
            '(\\?[;&a-z\\d%_.~+=-]*)?' + // query string
            '(\\#[-a-z\\d_]*)?$', 'i'); // fragment locator
        return !!pattern.test(str);
    }

    async function submitData() {
        const url = document.getElementById("url").value
        if (!isURL(url)) {
            alert("The URL is not valid. Please input a new URL")
            return
        }
        const name = document.getElementById("name").value
        if (name === "") {
            alert("Please enter a short URL")
            return
        }
        const response = await fetch(`/addURL?url=${url}&name=${name}`, {
            method: "POST"
        })
        if (response.status === 200) {
            alert("Link shortened successfully!")
        } else {
            const resp = await response.json();
            alert(resp.message)
        }
    }
</script>

<body>
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <img src="https://epochml.org/assets/epochCroppedLogoNoBackground.png" height="30">
            <a class="navbar-brand" href="/">&nbsp;&nbsp;Link Shortener</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto flex-nowrap mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="#">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/mylinks">My Links</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="/logout">Logout</a>
                    </li>
                </ul>
                <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
                    <li class="nav-item" style="float: right; margin-right: 0;">
                        <i class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Signed in as {{name}}
                            ({{email}})</i>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <div class="container">
        <br /><br />
        <h1>Shorten a URL</h1>
        <div class="mb-3">
            <label for="url" class="form-label">URL to shorten</label>
            <input type="text" class="form-control" id="url" aria-describedby="urlHelp">
            <div id="urlHelp" class="form-text">Enter a valid web URL.</div>
        </div>
        <div class="mb-3">
            <label for="name" class="form-label">Alias</label>
            <div class="input-group mb-3">
                <span class="input-group-text" id="basic-addon3">https://{{baseURL}}/</span>
                <input type="text" class="form-control" id="name" aria-describedby="nameHelp">
            </div>
            <div id="urlHelp" class="form-text">Enter the alias which will redirect to your original site.</div>
        </div>
        <button class="btn btn-primary" onclick="submitData()">Shorten!</button>
    </div>
</body>